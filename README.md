# Py7za ("pizza")

Python wrapper for running the 7za.exe utility from https://www.7-zip.org/

The wrapper simply runs the application in a separate process and provides the following added functionality:
- capture and parse output (overriding any `-bs_` arguments)
- track progress and some basic metrics (size, files processed, etc.)

Other than providing that utility, the wrapper tries to allow users access to 7za in a way as simple, and as close to the original as possible. See some documentation for the command line options here https://sevenzip.osdn.jp/chm/cmdline/index.htm (no affiliation).

Additionally, the package contains the `AsyncIOPool` class, which allows you to queue up a large number of asynchronous tasks, and it will keep a certain number of them running at all times, until all tasks are done. This works for any `asyncio` `Task`, but can be handily combined with `Py7za` (see below).

Finally, a command line utility `py7za-box` is included, which allows you to quickly replace individual files with their zipped equivalent in-place and vice versa.

## Install

Install the package:
```
pip install py7za
```

## Example

With the package installed, try running this script:
```
from py7za import Py7za

# zip all .txt files in c:\temp and subdirectories to texts.zip
Py7za.run(r'a c:\temp\*.txt texts.zip -r')
```

A simple example use of `AsyncIOPool`, to run multiple copies of 7za in parallel:
```python
async def zip_many(root, glob, target='.'):
    async for task_result in AsyncIOPool(pool_size=4).arun_many(
            [Py7za(f'a {target}/{fn.name}.zip {fn}') for fn in Path(root).glob(glob)]):
        print(task_result.arguments, task_result.return_code)

run(zip_man('c:/documents', '*.bak', target='c:/temp'))
```
This function would find a bunch of files and create zip files for each in another location, with 4 copies of 7za running at any time, until it's done.

Note: 7za supports multicore compression when compressing multiple files into a single archive. So if you're compressing many files into a few archives, it may not be optimal to create a pool with as many tasks as you have cores.

### Command line py7za-box

To quickly replace every .csv file in a folder and all its sub-folders with a zip-file containing that .csv:
```commandline
py7za-box --glob **/*.csv
```

Options for `py7za-box`:
- `--glob <glob expression>`<br>A glob expression that should match the individual files you want to (de)compress. Required.<br>More on globbing here https://docs.python.org/3/library/glob.html
- `--root <directory path>`<br>The root folder to which the glob expression applies. Default is `.` (the current working directory).
- `--unbox`<br>Cause 7za to unzip the matched files in-place (note that the glob should now match the archives, not the original files).
- `--verbose`<br>`py7za-box` will print the full command line for each run, with all the options provided to 7za.

Any additional options are passed to 7za on the command line, after the options generated by the script. Note that there are no checks performed on those options, use `--verbose` to see what may be causing unexpected behaviour when passing options like this.

A more elaborate example:
```commandline
py7za-box --glob **/*.csv --root c:/temp --verbose -mx=9
```

This would run `py7za-box` with `c:/temp` as the working directory, matching all .csv files in it and its sub-folders, printing the command line for each execution of 7za as it happens.

## License

This package is licensed under the MIT license. See [LICENSE.txt](https://gitlab.com/Jaap.vanderVelde/py7za/-/blob/master/LICENSE.txt).

## Changelog

See [CHANGELOG.md](https://gitlab.com/Jaap.vanderVelde/py7za/-/blob/master/CHANGELOG.md).
